{% extends '::base.html.twig' %}


{% block header %}
    {{ parent() }}
    {{ include('nav/menu.html.twig') }}
{% endblock %}

{% block alert %}

    {% for flash_message in app.session.flashbag.get('messageSuccess') %}
        {{  alerts.alert('alert-success', flash_message, null) }}
    {% endfor %}

    {% for flash_message in app.session.flashbag.get('messageFail') %}
        {{  alerts.alert('alert-warning', flash_message, null) }}
    {% endfor %}

{% endblock %}

{% block body %}
    <div class="container cd-main-content">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h2>Validar tu cuenta</h2>
                <hr/>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <p>¡Ya casi está! Para verificar tu teléfono recibirá un  SMS .
                    Tras recibir el SMS introduzca el código alfanumérico de 6 dígitos para finalizar su inscripción.
                </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">

                <h5>
                    {% if timeTried is not null %}
                        No le quedan intentos, vuelva a intentarlo en {{ timeTried }}

                    {% else %}
                        {# Mirar como se va a mostrar esto, xq me parece que así no queda bien#}
                        {{ 3 - numTried }} intento de 3 posibles.
                    {% endif %}

                </h5>
                <h5>
                    {{ 3 - numSMS }} SMS enviados de 3.
                </h5>


                {% if timeSMS is not null %}
                    Tiempo que falta para poder solicitar otro mensaje {{ timeSMS }}
                    {% set linkEnviaSMS = '' %}

                {% else %}
                    {% set linkEnviaSMS = "href= path('user_registerNewSMS')" %}
                {% endif %}
            </div>
        </div>
        {{ form_start(form) }}
            <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-8 col-center">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                Introduzca el SMS recibido
                            </h3>
                        </div>

                        <div class="panel-body">
                            <div class="form-group">
                                {{ form_row(form.codConfirmation) }}

                            </div>

                            <div class="form-group text-center">
                                {{ form_widget(form.confirmPhone,{'label':'Validar cuenta', 'attr':{'class': 'btn btn-default btn-normal'}}) }}
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </form>
        {# Hay que cambiar el link, le he puesto en disabled y se veía el mismo color #}
        <div class="row separacion-inferior">
            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-10 col-center">
                <p class="texto-info">El sms a veces puede tardar un poco en recibirlo, el SMS tiene un periodo válido
                    de 24 horas. En caso de no recibirlo compruebe que los datos que haya introducido son los correctos.
                    Si los datos son correctos pinche <a {{ linkEnviaSMS }} id="sendSMS" >aquí</a> para recibir un nuevo SMS para verificar la cuenta.
                </p>
            </div>
        </div>
    </div>

{% endblock %}



{% block javascriptsFooter %}
    {{ parent() }}
    {{ include('nav/menuScript.html.twig') }}

    <script type="text/javascript">
        $(document).ready(function(){

            $(document).on('click',$('#sendSMS'), sendSMS);

            function sendSMS(e){
                e.stopPropagation();
                {{ app.session.set('newCode','1') }}
                {#$.ajax({#}
                    {#url:'{{ path('user_ajax_sendSMS') }}',#}
                    {#success : function(data) {#}
                        {#if(data['result'] === 'ok'){#}
                            {#$('#blockAlert').html("<div class='alert "+#}
                                    {#"alert-success alert-dismissible' role='alert'>"+#}
                                    {#"<button type='button' class='close' "+#}
                                    {#"data-dismiss='alert' aria-label='Close'>"+#}
                                    {#"<span aria-hidden='true'>×</span>"+#}
                                    {#"</button><strong></strong>"+#}
                                    {#data['message']+"</div>");#}

                        {#}#}
                    {#},#}
                    {#error : function() {#}
                        {#console.log("error");#}
                    {#},#}
                    {#complete : function() {#}
                    {#}#}
                {#});#}
            }
        });
    </script>

{% endblock %}
